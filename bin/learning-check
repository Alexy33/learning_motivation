#!/bin/bash

# ============================================================================
# Learning Check - Validation des missions en cours
# ============================================================================

set -euo pipefail

# Configuration
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
readonly CONFIG_DIR="$HOME/.learning_challenge"
readonly LIB_DIR="$SCRIPT_DIR/lib"

# Import des modules
source "$LIB_DIR/config.sh"
source "$LIB_DIR/ui.sh"
source "$LIB_DIR/mission.sh"
source "$LIB_DIR/stats.sh"
source "$LIB_DIR/timer.sh"
source "$LIB_DIR/punishment.sh"

# ============================================================================
# Fonctions principales
# ============================================================================

main() {
    # Vérifier que la configuration existe
    if [[ ! -d "$CONFIG_DIR" ]]; then
        ui_error "Aucune configuration trouvée. Lancez d'abord 'learning.sh'"
        exit 1
    fi
    
    config_init
    
    # Vérifier s'il y a une mission active
    local mission_data
    mission_data=$(config_get_current_mission)
    
    if [[ "$mission_data" == "null" ]] || [[ -z "$mission_data" ]]; then
        ui_header "Aucune Mission Active"
        ui_info "Aucune mission en cours à valider."
        echo
        ui_info "Utilisez 'learning.sh' pour démarrer une nouvelle mission."
        exit 0
    fi
    
    # Procéder à la validation
    mission_validate
}

# Point d'entrée
main "$@"
